<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BTC Timelock Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0b1120 0, #020617 55%);
      color: #e5edf5;
    }
    .app {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px 14px 24px;
    }
    .app-title {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: #f7931a;
      margin-bottom: 4px;
    }
    .app-subtitle {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 14px;
    }
    .meta-row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 8px;
    }
    .tag {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: rgba(15, 23, 42, 0.92);
    }
    .group-title {
      font-size: 12px;
      font-weight: 500;
      margin: 14px 0 6px;
      color: #d1d5db;
    }
    .card {
      border-radius: 16px;
      border: 1px solid #1f2937;
      background: rgba(15, 23, 42, 0.96);
      padding: 10px 12px 8px;
      margin-bottom: 8px;
      box-shadow: 0 14px 32px rgba(0,0,0,0.6);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }
    .label {
      font-size: 13px;
      font-weight: 500;
    }
    .status-pill {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
    }
    .status-locked {
      background: rgba(127, 29, 29, 0.9);
      color: #fecaca;
      border-color: #7f1d1d;
    }
    .status-soon {
      background: rgba(120, 53, 15, 0.9);
      color: #fed7aa;
      border-color: #92400e;
    }
    .status-unlocked {
      background: rgba(22, 101, 52, 0.9);
      color: #bbf7d0;
      border-color: #15803d;
    }
    .status-spent {
      background: rgba(17, 24, 39, 0.9);
      color: #9ca3af;
      border-color: #374151;
    }
    .address {
      font-size: 10px;
      color: #9ca3af;
      word-break: break-all;
      margin-bottom: 4px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      margin-bottom: 2px;
    }
    .row span:last-child {
      font-variant-numeric: tabular-nums;
    }
    .hint {
      font-size: 10px;
      color: #6b7280;
      margin-top: 10px;
 /* BTC top bar (updated layout) */
.top-strip {
  display: flex;
  flex-direction: column;
  width: 100%;
  padding: 14px 16px;
  gap: 6px;
  background: rgba(0, 0, 0, 0.45);
  border-bottom: 1px solid rgba(255,255,255,0.15);
  color: #e5edf5;
  position: sticky;
  top: 0;
  z-index: 1000;
  backdrop-filter: blur(6px);
  min-height: 70px;
}

.top-strip__title {
  font-size: 12px;
  text-transform: uppercase;
  opacity: 0.75;
  letter-spacing: 0.1em;
}

.top-strip__price {
  font-size: 18px;
  font-weight: bold;
}

.top-strip__meta span {
  margin-right: 12px;
  font-size: 12px;
  opacity: 0.8;
}

.top-strip__link a {
  font-size: 11px;
  color: #f7931a;
  text-decoration: none;
}
    }
/* DCA stats panel */
.dca-panel {
  margin-top: 10px;
  padding-top: 8px;
  border-top: 1px dashed rgba(255, 255, 255, 0.18);
  font-size: 11px;
  line-height: 1.4;
  color: #cfd5ff;
}

.dca-panel .dca-title {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  opacity: 0.75;
  margin-bottom: 4px;
}

.dca-line {
  margin-bottom: 2px;
}

.dca-sats {
  opacity: 0.85;
}

.dca-chip-profit {
  color: #22c55e; /* green */
}

.dca-chip-loss {
  color: #ef4444; /* red */
}
 /* ==== DCA DASHBOARD STYLES ==== */
.dca-panel {
  margin: 1.5rem 0;
  padding: 1rem 1.25rem;
  border-radius: 12px;
  background: #101522;
  box-shadow: 0 0 12px rgba(0,0,0,0.4);
}

.dca-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
}

.dca-summary {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 0.5rem 1rem;
  margin-bottom: 1rem;
}

.dca-metric {
  display: flex;
  flex-direction: column;
  font-size: 0.85rem;
}

.dca-label {
  opacity: 0.8;
  margin-bottom: 0.1rem;
}

.dca-value {
  font-weight: 600;
}

.dca-subtitle {
  margin-top: 0.5rem;
  margin-bottom: 0.25rem;
  font-size: 0.9rem;
  font-weight: 500;
  opacity: 0.85;
}

/* Vault rows */
.dca-row {
  padding: 0.5rem 0.75rem;
  border-radius: 8px;
  margin-bottom: 0.35rem;
  font-size: 0.8rem;
}

.dca-row-profit {
  background: rgba(0, 180, 90, 0.15);
  border: 1px solid rgba(0, 180, 90, 0.4);
}

.dca-row-loss {
  background: rgba(220, 60, 60, 0.15);
  border: 1px solid rgba(220, 60, 60, 0.4);
}

.dca-row-neutral {
  background: rgba(255, 255, 255, 0.04);
  border: 1px solid rgba(255, 255, 255, 0.08);
}

.dca-row-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.25rem;
}

.dca-row-title {
  font-weight: 600;
}

.dca-row-sub {
  opacity: 0.6;
  font-family: monospace;
}

.dca-row-metrics {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem 1rem;
  opacity: 0.9;
} </style>
</head>
<body>
  
<!-- BTC REALTIME PRICE BAR -->
<div id="btc-price-bar" class="top-strip">
  <div class="top-strip__title">Bitcoin ‚Ä¢ Real-time</div>

  <div class="top-strip__price" id="btc-price">$--</div>

  <div class="top-strip__meta">
    <span id="btc-change">24h: --%</span>
    <span id="btc-marketcap">Mkt cap: --</span>
    <span id="btc-volume">24h vol: --</span>
  </div>

  <div class="top-strip__link">
    <a href="https://coinmarketcap.com/currencies/bitcoin/"
       target="_blank" rel="noopener noreferrer">
      View ‚Üí
    </a>
  </div>
</div>
<div id="gold-line" class="top-strip">
  ü™ô Gold ‚Ä¢ Mkt cap: <span id="gold-marketcap">$0</span>
</div>
  <div id="dca-dashboard" class="dca-panel">
  <div class="dca-title">üßÆ DCA Dashboard</div>

  <div class="dca-summary">
    <div class="dca-metric">
      <span class="dca-label">üíµ Total invested</span>
      <span id="dca-total-usd" class="dca-value">$0.00</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">‚Çø BTC accumulated</span>
      <span id="dca-total-btc" class="dca-value">0 BTC</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">‚ö° Sats accumulated</span>
      <span id="dca-total-sats" class="dca-value">0 sats</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">üîÄ Blended average</span>
      <span id="dca-avg-cost" class="dca-value">$0 / BTC</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">üìà Current value</span>
      <span id="dca-current-value" class="dca-value">$0.00</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">üìä P/L & ROI</span>
      <span id="dca-profit" class="dca-value">‚Äì</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">‚è≥ Time in market</span>
      <span id="dca-holding" class="dca-value">0 days</span>
    </div>
  </div>

  <div class="dca-subtitle">Vault breakdown</div>
  <div id="dca-rows"></div>

</div> <!-- end of dca-dashboard -->

<script>
// ===== DCA DATA & HELPERS =====

// Single source of truth for your DCA entries.
// Keyed by vault address.
const DCA_LOG = {
  // 2022 Vault
  "3KMrnQymf9gfu1QzYTepCGy8rv4Je2nHby": {
    label: "2022 ‚Äì Long CLTV",
    entries: [
      { date: "2022-03-12", usd: 500, btc: 0.01299249 }
    ]
  }

  // You can add more vaults here later, like:
  // "3ECBoJHeYwz4qDdovgHhME3Une89Zw63Ah": {
  //   label: "2026 Q1 ‚Äì Timelock",
  //   entries: [ /* your buys */ ]
  // }
};

// Compute totals for one vault
function computeDcaStats(entries, currentPriceUsd) {
  let totalUsd = 0;
  let totalBtc = 0;
  let earliestDate = null;

  for (const row of entries) {
    const usd = Number(row.usd) || 0;
    const btc = Number(row.btc) || 0;

    totalUsd += usd;
    totalBtc += btc;

    if (row.date) {
      const d = new Date(row.date);
      if (!isNaN(d)) {
        if (!earliestDate || d < earliestDate) {
          earliestDate = d;
        }
      }
    }
  }

  const totalSats = Math.round(totalBtc * 100000000);
  const price = Number(currentPriceUsd) || 0;
  const currentValue = totalBtc * price;
  const profitUsd = currentValue - totalUsd;
  const profitPct = totalUsd > 0 ? (profitUsd / totalUsd) * 100 : 0;

  let holdingDays = 0;
  if (earliestDate) {
    const now = new Date();
    holdingDays = Math.floor((now - earliestDate) / (1000 * 60 * 60 * 24));
  }

  const avgCost = totalBtc > 0 ? totalUsd / totalBtc : 0;

  return {
    totalUsd,
    totalBtc,
    totalSats,
    avgCost,
    currentValue,
    profitUsd,
    profitPct,
    holdingDays
  };
}

// Render the DCA dashboard into the top cards + vault rows
function renderDcaDashboard() {
  const price = window.CURRENT_BTC_PRICE || 0;

  const rowsEl = document.getElementById("dca-rows");
  if (!rowsEl) return;

  rowsEl.innerHTML = "";

  let grandUsd = 0;
  let grandBtc = 0;
  let grandSats = 0;
  let grandCurrent = 0;
  let grandProfit = 0;
  let maxHoldingDays = 0;

  for (const [address, cfg] of Object.entries(DCA_LOG)) {
    const entries = cfg.entries || [];
    const stats = computeDcaStats(entries, price);

    grandUsd     += stats.totalUsd;
    grandBtc     += stats.totalBtc;
    grandSats    += stats.totalSats;
    grandCurrent += stats.currentValue;
    grandProfit  += stats.profitUsd;
    if (stats.holdingDays > maxHoldingDays) {
      maxHoldingDays = stats.holdingDays;
    }

    // Build one vault row
    const row = document.createElement("div");
    row.className = "dca-row dca-row-neutral";
    row.innerHTML = `
      <div class="dca-row-header">
        <div class="dca-row-title">${cfg.label || "Vault"}</div>
        <div class="dca-row-sub">${address}</div>
      </div>
      <div class="dca-row-metrics">
        <span>Invested: $${stats.totalUsd.toFixed(2)}</span>
        <span>BTC: ${stats.totalBtc.toFixed(8)}</span>
        <span>Sats: ${stats.totalSats.toLocaleString()}</span>
      </div>
    `;
    rowsEl.appendChild(row);
  }

  // Helper to safely set text
  const $ = (id) => document.getElementById(id);

  if ($("dca-total-usd")) {
    $("dca-total-usd").innerText = "$" + grandUsd.toFixed(2);
  }
  if ($("dca-total-btc")) {
    $("dca-total-btc").innerText = grandBtc.toFixed(8) + " BTC";
  }
  if ($("dca-total-sats")) {
    $("dca-total-sats").innerText = grandSats.toLocaleString() + " sats";
  }
  if ($("dca-avg-cost")) {
    const avg = grandBtc > 0 ? (grandUsd / grandBtc) : 0;
    $("dca-avg-cost").innerText = "$" + avg.toFixed(0) + " / BTC";
  }
  if (document.getElementById("dca-current-value")) {
    document.getElementById("dca-current-value").innerText =
        "$" + grandCurrent.toFixed(2);
}
  if ($("dca-profit")) {
    const pct = grandUsd > 0 ? (grandProfit / grandUsd) * 100 : 0;
    const sign = grandProfit >= 0 ? "+" : "";
    $("dca-profit").innerText =
      `${sign}$${grandProfit.toFixed(2)} (${pct.toFixed(2)}%)`;
  }
  if ($("dca-holding")) {
    $("dca-holding").innerText = maxHoldingDays + " days";
  }
}

// Global price value (shared with live BTC script)
window.CURRENT_BTC_PRICE = window.CURRENT_BTC_PRICE || 0;

// On initial load, render once with price = 0
// (so you still see your $500 total invested even before price arrives)
document.addEventListener("DOMContentLoaded", () => {
  renderDcaDashboard();
});
</script> <!-- end of timelock monitor script -->

<!-- === LIVE BTC & GOLD PRICE SCRIPTS === -->
<script>
async function loadBTC() {
  try {
    const res = await fetch(
      "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_market_cap=true&include_24hr_vol=true&include_24hr_change=true"
    );
    const data = await res.json();

    const price = data.bitcoin.usd;
    CURRENT_BTC_PRICE = price;

    // Recalculate DCA dashboard when price updates
    if (typeof renderDcaDashboard === "function") {
      renderDcaDashboard();
    }

    const change = data.bitcoin.usd_24hr_change;
    const mcap   = data.bitcoin.usd_market_cap;
    const vol    = data.bitcoin.usd_24hr_vol;

    document.getElementById("btc-price").innerText     = "$" + price.toLocaleString();
    document.getElementById("btc-change").innerText    = "24h: " + change.toFixed(2) + "%";
    document.getElementById("btc-marketcap").innerText = "Mkt cap: " + mcap.toLocaleString();
    document.getElementById("btc-volume").innerText    = "24h vol: " + vol.toLocaleString();

    document.getElementById("btc-price").className =
      change >= 0 ? "price-up" : "price-down";
  } catch (e) {
    console.error("BTC API error", e);
  }
}

async function loadGoldMarketCap() {
  try {
    const res = await fetch(
      "https://api.coingecko.com/api/v3/simple/price?ids=gold&vs_currencies=usd&include_market_cap=true"
    );
    const data = await res.json();
    const mcap = data.gold.usd_market_cap;

    document.getElementById("gold-marketcap").innerText =
      "$" + mcap.toLocaleString();
  } catch (e) {
    console.error("Gold API error", e);
  }
}

// Refresh both every 30 seconds
setInterval(() => {
  loadBTC();
  loadGoldMarketCap();
}, 30000);

// Run both immediately on load
loadBTC();
loadGoldMarketCap();
</script>
</body>
</html>
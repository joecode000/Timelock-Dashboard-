<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BTC Timelock Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0b1120 0, #020617 55%);
      color: #e5edf5;
    }
    .app {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px 14px 24px;
    }
    .app-title {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: #f7931a;
      margin-bottom: 4px;
    }
    .app-subtitle {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 14px;
    }
    .meta-row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 8px;
    }
    .tag {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: rgba(15, 23, 42, 0.92);
    }
    .group-title {
      font-size: 12px;
      font-weight: 500;
      margin: 14px 0 6px;
      color: #d1d5db;
    }
    .card {
      border-radius: 16px;
      border: 1px solid #1f2937;
      background: rgba(15, 23, 42, 0.96);
      padding: 10px 12px 8px;
      margin-bottom: 8px;
      box-shadow: 0 14px 32px rgba(0,0,0,0.6);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }
    .label {
      font-size: 13px;
      font-weight: 500;
    }
    .status-pill {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
    }
    .status-locked {
      background: rgba(127, 29, 29, 0.9);
      color: #fecaca;
      border-color: #7f1d1d;
    }
    .status-soon {
      background: rgba(120, 53, 15, 0.9);
      color: #fed7aa;
      border-color: #92400e;
    }
    .status-unlocked {
      background: rgba(22, 101, 52, 0.9);
      color: #bbf7d0;
      border-color: #15803d;
    }
    .status-spent {
      background: rgba(17, 24, 39, 0.9);
      color: #9ca3af;
      border-color: #374151;
    }
    .address {
      font-size: 10px;
      color: #9ca3af;
      word-break: break-all;
      margin-bottom: 4px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      margin-bottom: 2px;
    }
    .row span:last-child {
      font-variant-numeric: tabular-nums;
    }
    .hint {
      font-size: 10px;
      color: #6b7280;
      margin-top: 10px;
 /* BTC top bar (updated layout) */
.top-strip {
  display: flex;
  flex-direction: column;
  width: 100%;
  padding: 14px 16px;
  gap: 6px;
  background: rgba(0, 0, 0, 0.45);
  border-bottom: 1px solid rgba(255,255,255,0.15);
  color: #e5edf5;
  position: sticky;
  top: 0;
  z-index: 1000;
  backdrop-filter: blur(6px);
  min-height: 70px;
}

.top-strip__title {
  font-size: 12px;
  text-transform: uppercase;
  opacity: 0.75;
  letter-spacing: 0.1em;
}

.top-strip__price {
  font-size: 18px;
  font-weight: bold;
}

.top-strip__meta span {
  margin-right: 12px;
  font-size: 12px;
  opacity: 0.8;
}

.top-strip__link a {
  font-size: 11px;
  color: #f7931a;
  text-decoration: none;
}
    }
/* DCA stats panel */
.dca-panel {
  margin-top: 10px;
  padding-top: 8px;
  border-top: 1px dashed rgba(255, 255, 255, 0.18);
  font-size: 11px;
  line-height: 1.4;
  color: #cfd5ff;
}

.dca-panel .dca-title {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  opacity: 0.75;
  margin-bottom: 4px;
}

.dca-line {
  margin-bottom: 2px;
}

.dca-sats {
  opacity: 0.85;
}

.dca-chip-profit {
  color: #22c55e; /* green */
}

.dca-chip-loss {
  color: #ef4444; /* red */
}
  </style>
</head>
<body>
  
<!-- BTC REALTIME PRICE BAR -->
<div id="btc-price-bar" class="top-strip">
  <div class="top-strip__title">Bitcoin ‚Ä¢ Real-time</div>

  <div class="top-strip__price" id="btc-price">$--</div>

  <div class="top-strip__meta">
    <span id="btc-change">24h: --%</span>
    <span id="btc-marketcap">Mkt cap: --</span>
    <span id="btc-volume">24h vol: --</span>
  </div>

  <div class="top-strip__link">
    <a href="https://coinmarketcap.com/currencies/bitcoin/"
       target="_blank" rel="noopener noreferrer">
      View ‚Üí
    </a>
  </div>
</div>

  <div id="dca-dashboard" class="dca-panel">
  <div class="dca-title">üßÆ DCA Dashboard</div>

  <div class="dca-summary">
    <div class="dca-metric">
      <span class="dca-label">üíµ Total invested</span>
      <span id="dca-total-usd" class="dca-value">$0.00</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">‚Çø BTC accumulated</span>
      <span id="dca-total-btc" class="dca-value">0 BTC</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">‚ö° Sats accumulated</span>
      <span id="dca-total-sats" class="dca-value">0 sats</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">üîÄ Blended average</span>
      <span id="dca-avg-cost" class="dca-value">$0 / BTC</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">üìà Current value</span>
      <span id="dca-current-value" class="dca-value">$0.00</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">üìä P/L & ROI</span>
      <span id="dca-profit" class="dca-value">‚Äì</span>
    </div>
    <div class="dca-metric">
      <span class="dca-label">‚è≥ Time in market</span>
      <span id="dca-holding" class="dca-value">0 days</span>
    </div>
  </div>

  <div class="dca-subtitle">Vault breakdown</div>
  <div id="dca-rows"></div>

</div> <!-- end of dca-dashboard -->
<div class="app">
  <div class="app-title">Timelock Monitor</div>
  <div class="app-subtitle">Multi-address BTC watch, grouped timelocks, color status, mobile-ready.</div>
  <div class="meta-row">
    <span class="tag" id="block-height">Height: ‚Ä¶</span>
    <span class="tag" id="last-updated">Updating‚Ä¶</span>
  </div>
  <div id="groups"></div>
  <div class="hint">
    ‚Ä¢ Green = unlocked & unspent ¬∑ Red = locked ¬∑ Amber = unlocking soon ¬∑ Gray = spent.<br>
    ‚Ä¢ Grant notification permission when prompted to get alerts on balance changes.
  </div>
</div>

<script>
// ===== DCA DATA & HELPERS =====

// Define your DCA (Dollar Cost Averaging) entries here.
// Keyed by address so each vault has its own log.
const DCA_LOG = {
  // 2022 vault (example ‚Äî edit or remove if you want)
  "3KMrnQymf9gfu1QzYTepCGy8rv4Je2nHby": {
    label: "2022 ‚Äì Long CLTV",
    entries: [
      // { date: "2024-01-01", usd: 100, btc: 0.0012 },
      // { date: "2024-03-01", usd: 150, btc: 0.0015 }
      // Add your real buys later
    ]
  },

  // 2026 Q1 timelock
  "3ECBoJHeYwz4qDdovgHhME3Une89Zw63Ah": {
    label: "2026 Q1 ‚Äì Timelock",
    entries: [
      // Example rows; replace with your actual buys
      // { date: "2025-01-01", usd: 200, btc: 0.0020 }
    ]
  },

  // 2026 Q2 timelock
  "346AQ1Gz8AP9rmzupgj36vsuecjyNdtqt4": {
    label: "2026 Q2 ‚Äì Timelock",
    entries: [
      // { date: "2025-02-01", usd: 200, btc: 0.0020 }
    ]
  },

  // Add future years (2027‚Äì2030) here when you have addresses.
};

function btcToSats(btc) {
  return Math.round(btc * 100_000_000);
}

function computeDcaStats(entries, currentPriceUsd) {
  if (!entries || entries.length === 0) {
    return {
      totalUsd: 0,
      totalBtc: 0,
      totalSats: 0,
      avgCost: 0,
      currentValue: 0,
      profitUsd: 0,
      profitPct: 0,
      holdingDays: 0
    };
  }

  let totalUsd = 0;
  let totalBtc = 0;
  let firstDate = null;

  for (const e of entries) {
    totalUsd += e.usd;
    totalBtc += e.btc;
    const d = new Date(e.date);
    if (!firstDate || d < firstDate) firstDate = d;
  }

  const totalSats = btcToSats(totalBtc);
  const avgCost = totalBtc > 0 ? totalUsd / totalBtc : 0;
  const currentValue = totalBtc * currentPriceUsd;
  const profitUsd = currentValue - totalUsd;
  const profitPct = totalUsd > 0 ? (profitUsd / totalUsd) * 100 : 0;

  let holdingDays = 0;
  if (firstDate) {
    const now = new Date();
    holdingDays = Math.floor((now - firstDate) / (1000 * 60 * 60 * 24));
  }

  return {
    totalUsd,
    totalBtc,
    totalSats,
    avgCost,
    currentValue,
    profitUsd,
    profitPct,
    holdingDays
  };
}
 // Global BTC price so DCA can use it
let CURRENT_BTC_PRICE = 0; // === CONFIG YOU EDIT ===
  const CONFIG = {
    network: "main", // "main" for mainnet
    // How often to refresh (ms)
    refreshMs: 30000,
    // How many blocks before unlock to treat as "soon"
    soonThresholdBlocks: 144, // ~1 day
    // Data source: BlockCypher simple usage
    apiBase: "https://api.blockcypher.com/v1/btc/main",
    // Addresses you want to monitor
    // For timelocks, you manually enter unlock info you used when creating them.
    addresses: [
      {
        label: "Vault A ‚Äì Long CLTV",
        address: "3KMrnQymf9gfu1QzYTepCGy8rv4Je2nHby",
        group: "Long Timelocks",
        unlockType: "height",      // "height" or "time"
        unlockHeight: 900000,      // if unlockType === "height"
        unlockTimeUnix: null       // if unlockType === "time" (Unix seconds), else null
      },
      {
        label: "Vault B ‚Äì 2026 Release",
        address: "YOUR_SECOND_ADDRESS_HERE",
        group: "Medium Timelocks",
        unlockType: "time",
        unlockHeight: null,
        unlockTimeUnix: 1780000000 // example future timestamp
      },
      {
        label: "Hot Watch Only",
        address: "YOUR_THIRD_ADDRESS_HERE",
        group: "Hot / Operational",
        unlockType: null,
        unlockHeight: null,
        unlockTimeUnix: null
      }
    ]
  };

  // === SIMPLE HELPERS ===
  function satsToBtc(sats) {
    return (sats / 100000000).toFixed(8);
  }

  function unixToLocal(unix) {
    if (!unix) return "‚Äî";
    return new Date(unix * 1000).toLocaleString();
  }

  function updateMeta(height) {
    document.getElementById("block-height").textContent = "Height: " + height;
    document.getElementById("last-updated").textContent =
      "Updated: " + new Date().toLocaleTimeString();
  }

  function computeStatus(addrCfg, height, balance, totalReceived) {
    // If nothing ever received
    if (!totalReceived) {
      return { status: "locked", label: "No funds yet" };
    }

    const nowUnix = Math.floor(Date.now() / 1000);

    // Spent (no current balance, but something was received)
    if (balance === 0) {
      return { status: "spent", label: "Spent" };
    }

    // If no timelock metadata, treat as "unlocked"
    if (!addrCfg.unlockType) {
      return { status: "unlocked", label: "Live / No Timelock" };
    }

    if (addrCfg.unlockType === "height" && addrCfg.unlockHeight) {
      const remaining = addrCfg.unlockHeight - height;
      if (remaining > CONFIG.soonThresholdBlocks) {
        return { status: "locked", label: `Locked ¬∑ ${remaining} blocks left` };
      } else if (remaining > 0) {
        return { status: "soon", label: `Unlocking soon ¬∑ ${remaining} blocks` };
      } else {
        return { status: "unlocked", label: `Unlocked at height ${addrCfg.unlockHeight}` };
      }
    }

    if (addrCfg.unlockType === "time" && addrCfg.unlockTimeUnix) {
      const remainingSec = addrCfg.unlockTimeUnix - nowUnix;
      if (remainingSec > 48 * 3600) {
        return { status: "locked", label: "Locked until " + unixToLocal(addrCfg.unlockTimeUnix) };
      } else if (remainingSec > 0) {
        return { status: "soon", label: "Unlocking soon ¬∑ " + Math.round(remainingSec / 3600) + "h" };
      } else {
        return { status: "unlocked", label: "Unlocked at " + unixToLocal(addrCfg.unlockTimeUnix) };
      }
    }

    return { status: "unlocked", label: "Live" };
  }

  function render(groupsData) {
    const container = document.getElementById("groups");
    container.innerHTML = "";
    Object.keys(groupsData).forEach(groupName => {
      const groupEl = document.createElement("div");

      const title = document.createElement("div");
      title.className = "group-title";
      title.textContent = groupName;
      groupEl.appendChild(title);

      groupsData[groupName].forEach(item => {
        const card = document.createElement("div");
        card.className = "card";

        const header = document.createElement("div");
        header.className = "card-header";

        const label = document.createElement("div");
        label.className = "label";
        label.textContent = item.config.label;

        const pill = document.createElement("div");
        pill.className =
          "status-pill status-" + item.status.status;
        pill.textContent = item.status.label;

        header.appendChild(label);
        header.appendChild(pill);
        card.appendChild(header);

        const addr = document.createElement("div");
        addr.className = "address";
        addr.textContent = item.config.address;
        card.appendChild(addr);

        const row1 = document.createElement("div");
        row1.className = "row";
        row1.innerHTML =
          "<span>Balance</span><span>" + satsToBtc(item.data.balance) + " BTC</span>";
        card.appendChild(row1);

        const row2 = document.createElement("div");
        row2.className = "row";
        row2.innerHTML =
          "<span>Total received</span><span>" + satsToBtc(item.data.total_received) + " BTC</span>";
        card.appendChild(row2);

        const row3 = document.createElement("div");
        row3.className = "row";
        row3.innerHTML =
          "<span>Unconfirmed</span><span>" + satsToBtc(item.data.unconfirmed_balance) + " BTC</span>";
        card.appendChild(row3);

        groupEl.appendChild(card);
      });

      container.appendChild(groupEl);
    });
  }

  // === NOTIFICATION SUPPORT (BROWSER LEVEL) ===
  function askNotificationPermissionOnce() {
    if (!("Notification" in window)) return;
    if (Notification.permission === "default") {
      Notification.requestPermission();
    }
  }

  function checkAndNotify(address, oldData, newData) {
    if (!("Notification" in window)) return;
    if (Notification.permission !== "granted") return;
    if (!oldData) return;

    if (oldData.balance !== newData.balance) {
      const diff = satsToBtc(newData.balance - oldData.balance);
      const dir = newData.balance > oldData.balance ? "received" : "sent";
      new Notification("BTC movement", {
        body: `${address} ${dir} ${diff} BTC`,
      });
    }
  }

  const lastSnapshot = {};

  // === MAIN POLL LOOP ===
  async function poll() {
    try {
      const heightRes = await fetch(CONFIG.apiBase);
      const heightJson = await heightRes.json();
      const height = heightJson.height;
      updateMeta(height);

      const groupsData = {};
      // Parallel fetch for addresses
      await Promise.all(
        CONFIG.addresses.map(async cfg => {
          const url = `${CONFIG.apiBase}/addrs/${cfg.address}/balance`;
          const res = await fetch(url);
          const data = await res.json();

          const status = computeStatus(
            cfg,
            height,
            data.balance,
            data.total_received
          );

          // Notification check
          checkAndNotify(cfg.address, lastSnapshot[cfg.address], data);
          lastSnapshot[cfg.address] = data;

          const groupName = cfg.group || "Ungrouped";
          if (!groupsData[groupName]) groupsData[groupName] = [];
          groupsData[groupName].push({ config: cfg, data, status });
        })
      );

      render(groupsData);
    } catch (e) {
      console.error("Poll error", e);
      document.getElementById("last-updated").textContent = "Error updating";
    }
  }

  askNotificationPermissionOnce();
  poll();
  setInterval(poll, CONFIG.refreshMs);

  </script>   <!-- end of timelock monitor script -->

<!-- === LIVE BTC PRICE SCRIPT === -->
<script>
async function loadBTC() {
  try {
    const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_market_cap=true&include_24hr_vol=true&include_24hr_change=true");
    const data = await res.json();

    const price  = data.bitcoin.usd;
CURRENT_BTC_PRICE = price;          // BTC price shared with DCA

const change = data.bitcoin.usd_24h_change;
const mcap   = data.bitcoin.usd_market_cap;
const vol    = data.bitcoin.usd_24h_vol;

document.getElementById("btc-price").innerText     = "$" + price.toLocaleString();
document.getElementById("btc-change").innerText    = "24h: " + change.toFixed(2) + "%";
document.getElementById("btc-marketcap").innerText = "Mkt cap: " + mcap.toLocaleString();
document.getElementById("btc-volume").innerText    = "24h vol: " + vol.toLocaleString();

document.getElementById("btc-price").className =
  change >= 0 ? "price-up" : "price-down";

    document.getElementById("btc-price").innerText = "$" + price.toLocaleString();
    document.getElementById("btc-change").innerText = "24h: " + change.toFixed(2) + "%";
    document.getElementById("btc-marketcap").innerText = "Mkt cap: " + mcap.toLocaleString();
    document.getElementById("btc-volume").innerText = "24h vol: " + vol.toLocaleString();

    document.getElementById("btc-price").className =
      change >= 0 ? "price-up" : "price-down";

  } catch (e) {
    console.error("BTC API error", e);
  }
}

setInterval(loadBTC, 30000);
loadBTC();
</script>

</body>
</html>